---
jupyter:
  jupytext:
    text_representation:
      extension: .md
      format_name: markdown
      format_version: '1.3'
      jupytext_version: 1.14.4
  kernelspec:
    display_name: C++
    language: c++
    name: xcpp11
---

---
Created time: 2025-04-15T16:58
åŠ å…¥å¸¦èƒŒ: false
jupyter:
  jupytext:
    cell_metadata_filter: language,-all
    formats: md,ipynb
    main_language: c++
    text_representation:
      extension: .md
      format_name: markdown
      format_version: '1.3'
      jupytext_version: 1.14.7
---
å½“ç„¶å¯ä»¥ï¼ä»¥ä¸‹æ˜¯ä¾§é‡äº **åŸå§‹æŒ‡é’ˆè¿­ä»£å™¨ï¼ˆRaw Pointer Iteratorï¼‰** ä½¿ç”¨åœºæ™¯çš„å­¦ä¹ ç¬”è®°æ•´ç†ï¼Œç»“åˆä½ å‰é¢çš„ä»£ç ï¼š
---
# ğŸ“˜ C++ åŸå§‹æŒ‡é’ˆä½œä¸ºè¿­ä»£å™¨ & `std::vector::insert` ç”¨æ³•å­¦ä¹ ç¬”è®°
---
## âœ… åœºæ™¯èƒŒæ™¯
åœ¨è¿›è¡Œ**äºŒè¿›åˆ¶æ•°æ®å†™å…¥ï¼ˆåºåˆ—åŒ–ã€æ‰“åŒ…ï¼‰**æ—¶ï¼Œæˆ‘ä»¬å¸¸ç”¨ï¼š


```
buffer.insert(buffer.end(), begin, end);
```

å…¶ä¸­ `begin` å’Œ `end` å¾€å¾€æ˜¯ **åŸå§‹æŒ‡é’ˆï¼ˆå¦‚** `**const char***`**ï¼‰**ï¼Œè¿™å°±ç”¨åˆ°äº† **åŸå§‹æŒ‡é’ˆè¿­ä»£å™¨** çš„æœºåˆ¶ã€‚
---
## ğŸ¯ ä»€ä¹ˆæ˜¯åŸå§‹æŒ‡é’ˆè¿­ä»£å™¨ï¼Ÿ
åœ¨ C++ STL ä¸­ï¼Œ`T*` å’Œ `const T*` æ˜¯åˆæ³•çš„è¾“å…¥è¿­ä»£å™¨ï¼ˆInputIteratorï¼‰
ğŸ‘‰ å¯ä»¥åƒ `vector<T>::iterator` ä¸€æ ·ï¼Œä¼ å…¥ STL ç®—æ³•æˆ–å®¹å™¨å‡½æ•°ä¸­
---
## ğŸ” ç¤ºä¾‹ï¼šå°†æ•´æ•°çš„å­—èŠ‚å†™å…¥ `std::vector<char>`


```
uint32_t val = 123;
const char* begin = reinterpret_cast<const char*>(&val);
const char* end = begin + sizeof(val);
std::vector<char> buffer;
buffer.insert(buffer.end(), begin, end);  // æ’å…¥åŸå§‹å­—èŠ‚
```

âœ… ä¸Šè¿°ä»£ç ä¸­ï¼š
- `begin` å’Œ `end` æ˜¯åŸå§‹æŒ‡é’ˆï¼Œ**è¡¨ç¤ºä¸€æ®µå†…å­˜åŒºé—´**
- `.insert()` æ¥æ”¶å®ƒä»¬ä½œä¸ºè¿­ä»£å™¨ï¼Œæ’å…¥åˆ° `buffer`
---
## ğŸ“Œ åŸå§‹æŒ‡é’ˆä½œä¸ºè¿­ä»£å™¨çš„è¡Œä¸ºç‰¹ç‚¹
|   |   |
|---|---|
|ç‰¹æ€§|è¯´æ˜|
|âœ… æŒ‡å‘çš„æ˜¯å†…å­˜åœ°å€|å…è®¸å¯¹ç»“æ„ä½“ã€æ•´æ•°ã€æ•°ç»„è¿›è¡Œ reinterpret_cast|
|âœ… éµå¾ªè¿­ä»£å™¨è¯­ä¹‰|æ”¯æŒ ++ã€+Nã€æ¯”è¾ƒç­‰æ“ä½œ|
|âœ… æ”¯æŒ STL ç®—æ³•|å¯ä»¥ç”¨äº `.insert()`, `.copy()`, `.sort()` ç­‰ç®—æ³•ä¸­|
|âš ï¸ å¿…é¡»ä¿è¯åˆæ³•æ€§|æŒ‡é’ˆå¿…é¡»æŒ‡å‘æœ‰æ•ˆå†…å­˜åŒºé—´ï¼Œä¸èƒ½è¶Šç•Œ|
---
## ğŸ¯ æ’å…¥åŸå§‹å­—èŠ‚åºåˆ—çš„é€šç”¨æ¨¡æ¿


```
template<typename T>
void appendBinary(std::vector<char>& buffer, const T& val) {
    const char* begin = reinterpret_cast<const char*>(&val);
    const char* end = begin + sizeof(T);
    buffer.insert(buffer.end(), begin, end);
}
```

å¯ä»¥ç”¨äºä»»ä½• POD ç±»å‹ï¼ˆæ•´æ•°ã€æµ®ç‚¹ã€ç»“æ„ä½“ï¼‰åºåˆ—åŒ–ã€‚
---
## ğŸ“ å¿«é€Ÿç¬”è®°æ€»ç»“
```Plain
# åŸå§‹æŒ‡é’ˆè¿­ä»£å™¨ç”¨æ³•æ€»ç»“
âœ… åŸå§‹æŒ‡é’ˆ = åˆæ³•çš„ STL è¾“å…¥è¿­ä»£å™¨
- char* / const char* å¯ä½œä¸º vector.insert çš„èŒƒå›´
ğŸ¯ å…¸å‹å†™æ³•ï¼š
buffer.insert(buffer.end(),
              reinterpret_cast<const char*>(&val),
              reinterpret_cast<const char*>(&val) + sizeof(val));
ğŸ’¡ åº”ç”¨åœºæ™¯ï¼š
- äºŒè¿›åˆ¶åºåˆ—åŒ–
- å†…å­˜ç»“æ„å†™å…¥ buffer
- æ–‡ä»¶å­˜å‚¨ã€socket ä¼ è¾“
âš ï¸ æ³¨æ„ï¼š
- æŒ‡é’ˆåŒºé—´å¿…é¡»åˆæ³•
- é€‚ç”¨äº POD ç±»å‹ï¼ˆéè™šç±»ã€éæŒ‡é’ˆæˆå‘˜ï¼‰
```
---
å¦‚æœä½ è¿˜æƒ³è¿›ä¸€æ­¥å»¶ä¼¸ï¼Œæˆ‘å¯ä»¥è¡¥ä¸€é¡µï¼š**åŸå§‹æŒ‡é’ˆä¸ STL ç®—æ³•å¦‚** `**std::copy**`**,** `**std::sort**`**,** `**std::lower_bound**` **è”åŠ¨çš„æŠ€å·§ä¸é™·é˜±**ï¼Œè¦ä¸è¦ç»§ç»­ï¼Ÿ
